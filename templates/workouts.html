{% extends "base.html" %}
{% block content %}
<h2>Sesiones</h2>

<a class="btn" href="/workouts/new">Nueva sesi√≥n</a>
<a class="btn" href="/analytics" style="background-color: #2196F3;">Ver Progreso üìà</a>
<div style="display: inline-block; margin-left: 10px;">
    <a class="btn" href="/export/csv" style="background-color: #4CAF50;">Exportar CSV üìä</a>
    <a class="btn" href="/export/json" style="background-color: #FF9800;">Backup JSON üíæ</a>
    <a class="btn" href="/measurements" style="background-color: #9C27B0;">Mediciones Corporales üìè</a>
</div>
<br><br>
<div class="calendar-container">
    <div class="calendar-header">
        <button id="prevMonth" class="btn-small">&lt;</button>
        <h3 id="monthYear"></h3>
        <button id="nextMonth" class="btn-small">&gt;</button>
    </div>
    <div class="calendar-grid" id="calendar"></div>
</div>

<style>
    .calendar-container {
        max-width: 400px;
        margin: 20px auto;
        border: 1px solid #444;
        border-radius: 8px;
        padding: 10px;
        background-color: #222;
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        color: #fff;
        /* Ensure header text is white */
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        text-align: center;
    }

    .calendar-day {
        padding: 8px;
        border-radius: 4px;
        background-color: #333;
        color: #fff;
        /* Ensure day numbers are white */
    }

    .calendar-day.has-workout {
        background-color: #4CAF50;
        /* Green for workout days */
        color: white;
        font-weight: bold;
    }

    .calendar-day.empty {
        background-color: transparent;
    }

    .btn-small {
        padding: 5px 10px;
        background-color: #555;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
</style>

<script>
    const workoutDates = {{ workout_dates | tojson }}; // List of "YYYY-MM-DD"
    const calendarEl = document.getElementById('calendar');
    const monthYearEl = document.getElementById('monthYear');
    let currentDate = new Date();

    function renderCalendar(date) {
        calendarEl.innerHTML = '';
        const year = date.getFullYear();
        const month = date.getMonth();

        monthYearEl.textContent = date.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        // Adjust for Monday start (0=Sunday, 1=Monday...)
        // If we want Monday as first day: (firstDay + 6) % 7
        // Let's stick to standard Sunday start for simplicity or adjust if needed.
        // Let's assume standard Sunday start for now.

        for (let i = 0; i < firstDay; i++) {
            const emptyDiv = document.createElement('div');
            emptyDiv.className = 'calendar-day empty';
            calendarEl.appendChild(emptyDiv);
        }

        for (let i = 1; i <= daysInMonth; i++) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            dayDiv.textContent = i;

            const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
            if (workoutDates.includes(dateString)) {
                dayDiv.classList.add('has-workout');
            }

            calendarEl.appendChild(dayDiv);
        }
    }

    document.getElementById('prevMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate);
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate);
    });

    renderCalendar(currentDate);
</script>
<br><br>

<div class="table-wrapper">
    <table class="table-custom">
        <thead>
            <tr>
                <th>Fecha Sesi√≥n</th>
                <th>Notas</th>
                <th>Grupo Muscular</th>
                <th>Ejercicio</th>
                <th>Series</th>
                <th>Reps</th>
                <th>Peso</th>
                <th>Comentario</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for w in workouts %}
            <tr>
                <td>{{ w[0] }}</td>
                <td>{{ w[8] }}</td>
                <td>{{ w[1] if w[1] is not none else '-' }}</td>
                <td>{{ w[2] if w[2] is not none else '-' }}</td>
                <td>{{ w[3] if w[3] is not none else '-' }}</td>
                <td>{{ w[4] if w[4] is not none else '-' }}</td>
                <td>{{ w[5] if w[5] is not none else '-' }}</td>
                <td>{{ w[6] if w[6] is not none else '-' }}</td>
                <td style="white-space: nowrap;">

                    <a class="btn" href="/workouts/edit/{{ w[7] }}" title="Editar">‚úèÔ∏è</a>
                    <a class="btn btn-danger" href="/workouts/delete/{{ w[7] }}" title="Eliminar"
                        onclick="return confirm('¬øEst√°s seguro?')">üóëÔ∏è</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}