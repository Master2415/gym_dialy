<!DOCTYPE html>
<html>

<head>
    <title>Gym Diario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/style.css">
    <script>
        // Check for saved theme preference, otherwise use system preference
        const getPreferredTheme = () => {
            const storedTheme = localStorage.getItem('theme')
            if (storedTheme) {
                return storedTheme
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        const setTheme = (theme) => {
            document.documentElement.setAttribute('data-theme', theme)
            localStorage.setItem('theme', theme)
            updateIcon(theme)
        }

        const updateIcon = (theme) => {
            const icon = document.getElementById('theme-toggle-icon')
            if (icon) {
                icon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™'
            }
        }

        // Apply theme immediately
        setTheme(getPreferredTheme())

        window.addEventListener('DOMContentLoaded', () => {
            const toggleBtn = document.getElementById('theme-toggle')
            if (toggleBtn) {
                updateIcon(document.documentElement.getAttribute('data-theme'))
                toggleBtn.addEventListener('click', () => {
                    const currentTheme = document.documentElement.getAttribute('data-theme')
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark'
                    setTheme(newTheme)
                })
            }
        })
    </script>
</head>

<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>ğŸ‹ï¸ Diario de Entrenamiento</h1>
            <div style="display: flex; align-items: center; gap: 15px;">
                {% if session.get('user_id') %}
                <span>Hola, <strong>{{ session.get('username') }}</strong></span>
                <a href="/logout" class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9rem;">Salir</a>
                {% endif %}
                <button id="theme-toggle" class="btn btn-secondary"
                    style="padding: 5px 10px; font-size: 1.2rem; margin: 0;">
                    <span id="theme-toggle-icon">ğŸŒ™</span>
                </button>
            </div>
        </div>
        <hr>
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="alert-container">
            {% for message in messages %}
            <div class="alert">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </div>
</body>

</html>